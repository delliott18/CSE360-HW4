/**
 * Represents a moderation flag placed on a piece of user‑generated content
 * (question, answer, or review).  Flags are created by staff members and can
 * later be resolved by an instructor.  A flag may also carry an internal note
 * explaining the reason or required action.
 */
public class Flag {

    /**
     * Creates a new <code>Flag</code> instance.
     *
     * @param id         unique identifier generated by {@link MemoryStorage}
     * @param itemType   the type of the flagged item: <code>"QUESTION"</code>,
     *                   <code>"ANSWER"</code> or <code>"REVIEW"</code>
     * @param itemId     the primary‑key of the content being flagged
     * @param flaggedBy  username of the staff member who raised the flag
     * @param flaggedOn  timestamp when the flag was created
     */
    public Flag(int id,
                String itemType,
                int itemId,
                String flaggedBy,
                LocalDateTime flaggedOn) { … }

    /**
     * @return the unique identifier of this flag
     */
    public int getId() { … }

    /**
     * @return the content type that was flagged
     */
    public String getItemType() { … }

    /**
     * @return the id of the content that was flagged
     */
    public int getItemId() { … }

    /**
     * @return <code>true</code> if the flag has been resolved
     */
    public boolean isResolved() { … }

    /**
     * @return the username that raised the flag
     */
    public String getFlaggedBy() { … }

    /**
     * @return the moment the flag was created
     */
    public LocalDateTime getFlaggedOn() { … }

    /**
     * @return the optional internal note associated with this flag
     */
    public String getNote() { … }

    /**
     * Replaces the note attached to this flag.
     *
     * @param note free‑form explanatory text (may be empty)
     */
    public void setNote(String note) { … }

    /**
     * Marks the flag as resolved.
     *
     * @param resolver  instructor username that resolved the flag
     * @param when      timestamp of the resolution action
     */
    public void resolve(String resolver, LocalDateTime when) { … }
}

/* ------------------------------------------------------------------------- */

/**
 * Modal dialog that allows staff to create or update a flag for a specific
 * question, answer or review.  After successful submission the provided
 * <code>onComplete</code> callback is invoked so the caller can refresh its
 * display.
 */
public class FlagDialog extends JDialog {

    /**
     * Opens (or focuses) the flag dialog for the given content item.
     *
     * @param owner       parent frame used for modality
     * @param itemType    <code>"QUESTION"</code>, <code>"ANSWER"</code> or
     *                    <code>"REVIEW"</code>
     * @param itemId      identifier of the content to flag
     * @param currentUser username of the staff member
     * @param onComplete  runnable executed after the flag is saved
     */
    public static void showDialog(Frame owner,
                                  String itemType,
                                  int itemId,
                                  String currentUser,
                                  Runnable onComplete) { … }
}

/* ------------------------------------------------------------------------- */

/**
 * Instructor‑only panel that lists all active moderation flags.  The panel
 * provides quick actions to view the internal note associated with a flag and
 * to mark one or more flags as resolved.
 */
public class FlaggedItemsPanel extends JPanel {

    /**
     * Builds the panel and immediately loads the current list of unresolved
     * flags from {@link MemoryStorage}.
     *
     * @param currentUser username of the instructor viewing the panel
     */
    public FlaggedItemsPanel(String currentUser) { … }

    /**
     * Refreshes the table with the latest unresolved flags.  Called on first
     * construction and whenever the instructor presses the <em>Refresh</em>
     * or <em>Mark Resolved</em> buttons.
     */
    private void loadFlags() { … }
}

/* ------------------------------------------------------------------------- */

/**
 * New moderation helper methods added to {@link MemoryStorage} in HW4.
 */
public final class MemoryStorage {

    /**
     * Creates a new flag unless an unresolved flag already exists for the same
     * item.  Duplicate attempts return <code>-1</code>.
     *
     * @param itemType      the type of content being flagged
     * @param itemId        identifier of the content
     * @param staffUsername username of the staff member raising the flag
     * @return id of the new flag, or <code>-1</code> if a duplicate exists
     */
    public static int addFlag(String itemType, int itemId, String staffUsername) { … }

    /**
     * Adds or replaces the note on an unresolved flag.
     *
     * @param flagId id of the flag to update
     * @param note   explanatory text
     */
    public static void setFlagNote(int flagId, String note) { … }

    /**
     * Marks a flag as resolved.
     *
     * @param flagId           id of the flag
     * @param resolverUsername instructor who resolved the flag
     */
    public static void resolveFlag(int flagId, String resolverUsername) { … }

    /**
     * Retrieves the unresolved flag for the given item, if any.
     */
    public static Optional<Flag> getActiveFlag(String itemType, int itemId) { … }

    /**
     * Returns a list of flags; resolved flags are included only when
     * <code>includeResolved</code> is <code>true</code>.
     */
    public static List<Flag> getFlags(boolean includeResolved) { … }
}
